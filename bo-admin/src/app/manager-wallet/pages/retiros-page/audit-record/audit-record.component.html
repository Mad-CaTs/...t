<div class="container-audit" [formGroup]="form">
	<nav class="d-flex flex-row bg-white w-100 justify-content-center position-relative mb-10 ps-4 pt-3">
		<button class="btn px-2 p-lg-2 rounded-5 text-center w-100" [class.text-orange]="isStateOfTab"
			[class.fw-medium]="isStateOfTab" [ngStyle]="{
				border: '2px solid ' + (isStateOfTab ? 'orange' : 'white')
			}" (click)="onTabChange(true)">
			Modificaciones
		</button>
		<button class="btn px-2 p-lg-2 rounded-5 text-center w-100" [class.text-orange]="!isStateOfTab"
			[class.fw-medium]="!isStateOfTab" [ngStyle]="{
				border: '2px solid ' + (!isStateOfTab ? 'orange' : 'white')
			}" (click)="onTabChange(false)">
			Archivos Descargados/Subidos
		</button>
	</nav>

	<ng-container *ngIf="isStateOfTab">
		<div class="filters-grid w-100 gap-4 px-5">
			<div class="flex-fill">
				<label for="search" class="form-label fs-6 text-muted fw-bold">Buscador</label>
				<input type="text" id="search" class="form-control" formControlName="search" placeholder="Buscar..." />
			</div>
			<div class="flex-fill">
				<app-month-period-selector [formGroup]="form" controlName="cicles" periodsControlName="periods"
					[groupedOptions]="monthOptions" [placeholder]="'Selecciona un mes'" [label]="'Ciclos o periodos'"
					(selectionChange)="onPeriodsSelected($event)" class=""></app-month-period-selector>
			</div>
			<div class="flex-fill">
				<label for="createDate" class="form-label fs-6 text-muted fw-bold">Fecha de creación</label>
				<input type="date" id="createDate" class="form-control" (change)="onDateChange($event)" />
			</div>
			<div class="flex-fill">
				<app-select label="Acción" placeholder="Selecciona un opción" [options]="statusReviewOptions"
					[formGroup]="form" controlName="actionId" class="w-100"></app-select>
			</div>
		</div>

		<div class="audit-container">
			<div class="type-entry-card d-flex flex-column gap-6 p-6 bg-white w-100">
				<ng-container *ngIf="!isLoading; else loadingTemplate">
					<ng-container *ngIf="data.length > 0; else empty">
						<app-table-generic [showActions]="false" [columns]="columns" [keys]="keys" [data]="data"
							[columnWidths]="clmnWidth" [pageIndex]="pageIndex" [pageSize]="pageSize">
						</app-table-generic>

						<app-table-paginator [pageSize]="pageSize" [pageIndex]="pageIndex" [length]="totalItems"
							(pageChange)="onPageChange($event)" (pageSizeChange)="onPageSizeChange($event)">
						</app-table-paginator>
					</ng-container>
				</ng-container>
			</div>
		</div>
	</ng-container>

	<ng-container *ngIf="!isStateOfTab">
		<div class="filters-grid w-100 gap-4 px-5">
			<div class="flex-fill">
				<label for="search" class="form-label fs-6 text-muted fw-bold">Buscador</label>
				<input type="text" id="search" class="form-control" formControlName="search" placeholder="Buscar..." />
			</div>
			<div class="flex-fill">
				<app-month-period-selector [formGroup]="form" controlName="cicles" periodsControlName="periods"
					[groupedOptions]="monthOptions" [placeholder]="'Selecciona un mes'" [label]="'Ciclos o periodos'"
					(selectionChange)="onPeriodsSelected($event)" class=""></app-month-period-selector>
			</div>
			<div class="flex-fill">
				<label for="createDate" class="form-label fs-6 text-muted fw-bold">Fecha de creación</label>
				<input type="date" id="createDate" class="form-control" (change)="onDateChange($event)" />
			</div>
			<div class="flex-fill">
				<app-select label="Acción" placeholder="Selecciona un opción" [options]="statusReviewOptions"
					[formGroup]="form" controlName="actionId" class="w-100"></app-select>
			</div>
		</div>

		<div class="audit-container">
			<div class="type-entry-card d-flex flex-column gap-6 p-6 bg-white w-100">
				<ng-container *ngIf="!isLoading; else loadingTemplate">
					<ng-container *ngIf="dataOfFiles.length > 0; else empty">
						<div class="table-wrapper">
							<table class="table-generic">
								<thead>
									<tr>
										<th>Fecha y Hora</th>
										<th>Usuario</th>
										<th>Nombre de archivo</th>
										<th>Registros</th>
										<th>Acción</th>
										<th>Tamaño</th>
									</tr>
								</thead>
								<tbody>
									<tr *ngFor="let row of dataOfFiles; let i = index">
										<td>{{row.fechaHora}}</td>
										<td>{{row.userName}}</td>
										<td>
											<a href="javascript:void(0)"
												class="text-primary text-decoration-underline cursor-pointer"
												(click)="onDownloadFile(row)">
												{{row.fileName}}
											</a>
										</td>
										<td>{{row.registros}}</td>
										<td>{{getActionDescription(row.actionId)}}</td>
										<td>{{row.tamano}}</td>
									</tr>
								</tbody>
							</table>
						</div>

						<app-table-paginator [pageSize]="pageSize" [pageIndex]="pageIndex"
							(pageChange)="onPageChange($event)" (pageSizeChange)="onPageSizeChange($event)" [length]="totalItems">
						</app-table-paginator>
					</ng-container>
				</ng-container>
			</div>
		</div>
	</ng-container>

	<ng-template #loadingTemplate>
		<div class="d-flex justify-content-center align-items-center py-5">
			<div class="spinner-border text-primary" role="status">
				<span class="visually-hidden">Cargando...</span>
			</div>
		</div>
	</ng-template>

	<ng-template #empty>
		<app-empty-state
			[message]="isStateOfTab ? 'No se encontraron modificaciones' : 'No se encontraron archivos'"></app-empty-state>
	</ng-template>
</div>