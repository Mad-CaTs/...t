<div class="container">
	<h4 class="fw-bold">Dirección de Envío</h4>
	<p class="text-muted">Dirección de Envío</p>
	<form [formGroup]="formUser">
		<div class="d-flex flex-wrap gap-1">
			<div class="d-flex flex-column flex-md-row gap-1 gap-md-2 w-100">
				<div class="form-group w-100">
					<app-select
						class="w-100"
						[showImg]="true"
						label="País de residencia"
						placeholder="Seleccione su país"
						[form]="formUser"
						[options]="nationalitiesList"
						controlName="idResidenceCountry"
					></app-select>
				</div>

				<div class="form-group w-100">
					<app-input
						label="Departamento"
						placeholder="Seleccione su Departamento"
						[form]="formUser"
						controlName="department"
						class="w-100"
					></app-input>
				</div>
				<!-- 	-->
			</div>

			<div class="d-flex flex-column flex-md-row gap-1 gap-md-2 w-100">
				<div class="form-group w-100">
					<app-input
						class="size-14"
						label="Provincia"
						placeholder="Seleccione su provincia"
						[form]="formUser"
						controlName="province"
					></app-input>
				</div>
				<div class="form-group w-100">
					<div class="form-group w-100">
						<app-input
							label="Distrito"
							placeholder="Seleccione su distrito"
							[form]="formUser"
							controlName="districtAddress"
							class="w-100"
						></app-input>
					</div>
				</div>
			</div>
			<app-input
				class="w-100"
				label="Dirección"
				placeholder="Tu dirección"
				[form]="formUser"
				controlName="address"
			></app-input>

			<div
				class="col-12"
				*ngIf="!isLoading && (!sucursalesCercanas || sucursalesCercanas.length === 0)"
			>
				<div class="alert alert-info d-flex align-items-center px-4 py-2">
					<img src="assets/icons/info.svg" alt="info" class="me-2" width="24" />
					<span>
						Para sugerirte la sucursal de Serpost más cercana, por favor completa los campos de
						Distrito, Provincia y Dirección. Así podremos ubicarte mejor.
					</span>
				</div>
			</div>

			<div
				*ngIf="isLoading || showLoader"
				class="d-flex flex-column justify-content-center align-items-center"
				style="height: 300px"
			>
				<app-loader [size]="'3rem'" [strokeWidth]="'3'"></app-loader>
				<span class="mt-3 fw-semibold text-center">
					Buscando sucursales cercanas a tu dirección, por favor espera un momento...
				</span>
			</div>

			<div *ngIf="!isLoading && sucursalesCercanas.length > 0">
				<h5 class="mt-4">Sucursales de Serpost más cercanas:</h5>
			</div>

			<div
				*ngIf="!isLoading && errorMessage"
				class="alert alert-danger d-flex align-items-center px-4 py-2 mt-2"
			>
				<img src="assets/icons/error.svg" alt="error" class="me-2" width="24" />
				<span>{{ errorMessage }}</span>
			</div>

			<!-- Mensaje cuando no hay resultados -->
			<div
				*ngIf="!isLoading && noResultsMessage"
				class="alert alert-warning d-flex align-items-center px-4 py-2 mt-2"
			>
				<img src="assets/icons/info.svg" alt="info" class="me-2" width="24" />
				<span>{{ noResultsMessage }}</span>
			</div>

			<div
				*ngIf="!isLoading && sucursalesCercanas.length > 0"
				class="d-flex flex-column flex-md-row w-100"
				style="gap: 0.5rem"
			>
				<div class="form-group flex-grow-2 overflow-auto cursor-pointer" style="max-height: 400px">
					<div *ngFor="let sucursal of sucursalesCercanas">
						<app-serpost-option
							[sucursal]="sucursal"
							(optionClick)="onMarkerClick($event)"
							[selected]="sucursalSeleccionada === sucursal"
							class="w-100"
						></app-serpost-option>
					</div>
				</div>

				<div class="form-group flex-grow-1" style="min-height: 300px">
					<app-sucursales-map
						*ngIf="coords"
						[sucursales]="sucursalesCercanas"
						[center]="[coords.lat, coords.lon]"
						(markerClick)="onMarkerClick($event)"
					>
						class="w-100 h-100 d-block" ></app-sucursales-map
					>
				</div>
			</div>

			<div class="col-12" *ngIf="!isLoading && sucursalesCercanas.length > 0">
				<div class="alert alert-info d-flex align-items-center px-4 py-2">
					<img src="assets/icons/info.svg" alt="info" class="me-2" width="24" />
					<span> El envío a cualquier provincia tiene un costo fijo: S/ 20.00  </span>
				</div>
			</div>

			<div
				*ngIf="selectedProduct && selectedProduct.tipo === 2"
				class="d-flex flex-column flex-md-row gap-1 gap-md-2 mt-3 w-100"
			>
				<div class="form-group w-100">
					<app-radios
						class="w-100"
						[form]="formUser"
						verticalLayout="true"
						controlName="availability"
						[options]="optList"
						label="¿Cuentas con disponibilidad?"
					></app-radios>
				</div>
			</div>

			<div *ngIf="selectedProduct && selectedProduct.tipo === 2" class="col-12">
				<div class="alert alert-info d-flex align-items-center px-4 py-2">
					<img src="assets/icons/info.svg" alt="info" class="me-2" width="24" />
					<span
						>Recuerda: Si estás tramitando la legalización de tu contrato, deberás acudir a la
						Notaría Herrera Carrera en Miraflores, Lima - Perú, para firmarlo en la fecha que se
						indique en el cronograma de legalizaciones.</span
					>
				</div>
			</div>

			<div class="d-flex flex-column flex-md-row align-items-center gap-1 gap-md-2 w-100">
				<app-radios
					class="w-100"
					[form]="formUser"
					controlName="typeLegalization"
					[options]="optTypeLegalization"
					label="Tipo de legalización:"
				></app-radios>

				<div class="form-check form-check-inline d-flex align-items-center">
					<a
						href="#"
						(click)="openCronogramaAlert($event)"
						class="ms-3 text-secondary fw-semibold text-decoration-none d-flex align-items-center"
						style="white-space: nowrap"
					>
						<img
							src="assets/icons/link.svg"
							alt="link icon"
							width="20"
							height="20"
							class="me-2"
						/>
						Ver cronograma de entrega
					</a>
				</div>
			</div>
		</div>
	</form>
</div>
