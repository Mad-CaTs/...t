<form [formGroup]="prospectForm">

  <div class="d-flex flex-column flex-md-row gap-2 gap-md-4 w-100">
    <div class="d-flex flex-column w-50">
      <h1 class="m-0 fs-4 text-black fw-medium mt-0">{{ isPromotionalGuest ? 'Datos personales' : 'Datos del prospecto'
        }}
      </h1>

      <h2 *ngIf="isPromotionalGuest" class="m-0 fs-6 text-muted mt-2">
        Ingrese los datos del invitado promocional
      </h2>
    </div>

    <div class="d-flex flex-column w-50 align-items-end" *ngIf="!isPromotionalGuest">
      <button class="p-button p-component btn btn-outline-secondary p-button-warning text-center button-link"
        type="button" [disabled]="linkLoading" (click)="saveLink()">
        <span *ngIf="!linkLoading">Copiar Link</span>
        <div class="d-flex justify-content-center align-items-center" *ngIf="linkLoading">
          <p-progressSpinner [style]="{ width: '1.5rem', height: '1rem' }" strokeWidth="8" fill="transparent"
            animationDuration=".5s"></p-progressSpinner>
        </div>
      </button>
    </div>
  </div>
  <div class="d-flex flex-column flex-md-row gap-2 gap-md-4 w-100">
    <div class="question-container d-flex flex-column w-50" *ngIf="isPromotionalGuest">
      <label class="fw-bold">Selección de tipo de invitado</label>
      <div class="radio-group">
        <label>
          <input type="radio" formControlName="prospectType" value="1" />
          Promocional
        </label>
        <label>
          <input type="radio" formControlName="prospectType" value="2" />
          Regular
        </label>
      </div>
    </div>

    <div class=" d-flex flex-column w-50" *ngIf="prospectForm.get('prospectType')?.value === '2'">
      <app-select class="w-100" label="Membresía" placeholder="Seleccione una Membresía." [options]="specialTypes"
        [form]="prospectForm" controlName="specialType"></app-select>
    </div>
  </div>


  <div class="d-flex flex-column flex-md-row gap-2 gap-md-4 w-100">
    <div class="d-flex flex-column w-50">
      <app-input [form]="prospectForm" controlName="name" label="Nombres *" type="text"
        placeholder="Ingrese sus nombres" buttons="true" class="w-100"></app-input>
    </div>
    <div class="d-flex flex-column w-50">
      <app-input [form]="prospectForm" controlName="lastName" label="Apellidos *" type="text"
        placeholder="Ingrese sus apellidos" buttons="true" class="w-100"></app-input>
    </div>
  </div>
  <div class="d-flex flex-column flex-md-row gap-2 gap-md-4 w-100">
    <div class="d-flex flex-column w-50">
      <app-select class="w-100" label="Género" placeholder="Género *" [options]="optGenders" [form]="prospectForm"
        controlName="gender"></app-select>
    </div>
    <div class="d-flex flex-column w-50">
      <app-select class="w-100" [showImg]="true" label="Nacionalidad *" placeholder="Selecciona la nacionalidad"
        [form]="prospectForm" [options]="nationalitiesList" controlName="residenceCountryId"
        (onChangeSelection)="getDocumentType($event)"></app-select>
    </div>
  </div>

  <div class="d-flex flex-column flex-md-row gap-2 gap-md-4 w-100 mt-4" *ngIf="isPromotionalGuest">
    <div class="d-flex flex-column w-50">
      <app-select class="w-100" label="Estado Civil" placeholder="Selecciona un estado civil" [form]="prospectForm"
        [options]="civilStateList" controlName="civilState"></app-select>
    </div>
    <div class="d-flex flex-column w-50">
      <app-date class="w-100" placeholder="DD/MM/YYYY" label="Fecha de nacimiento" [form]="prospectForm"
        controlName="birthdate" [config]="true">
      </app-date>
    </div>
  </div>

  <div class="d-flex flex-column flex-md-row gap-2 gap-md-4 w-100 mt-4">
    <div class="d-flex flex-column w-50">
      <app-select class="w-100" [showImg]="false" label="Tipo de documento *" placeholder="Seleccione su documento"
        [form]="prospectForm" [options]="documentTypes" controlName="documentId"></app-select>
    </div>
    <div class="d-flex flex-column w-50">
      <app-input [form]="prospectForm" controlName="nroDocument" label="Documento *" type="text" placeholder="00000000"
        buttons="true" class="w-100"></app-input>
    </div>
  </div>
  <div class="d-flex flex-column flex-md-row gap-2 gap-md-4 w-100">
    <div class="d-flex flex-column w-50">
      <app-input [form]="prospectForm" controlName="email" label="Correo electrónico *" type="text"
        placeholder="correo@email.com" buttons="true" class="w-100"></app-input>
    </div>
    <div class="d-flex flex-column w-50">
      <app-input [form]="prospectForm" controlName="nroPhone" label="Nro de celular *" type="text"
        placeholder="00000000" buttons="true" class="w-100"></app-input>
    </div>
  </div>
  <div class="d-flex flex-column flex-md-row gap-2 gap-md-4 w-100">
    <div class="d-flex flex-column w-50">
      <div class="question-container" *ngIf="!isPromotionalGuest">
        <label>¿Dónde conoció al usuario a registrar?</label>
        <div class="radio-group mt-3">
          <label>
            <input type="radio" formControlName="prospectType" value="1" />
            Eventos
          </label>
          <label>
            <input type="radio" formControlName="prospectType" value="2" />
            Zoom
          </label>
          <label>
            <input type="radio" formControlName="prospectType" value="3" />
            Presentación
          </label>
          <label>
            <input type="radio" formControlName="prospectType" value="4" />
            Otros
          </label>
        </div>
      </div>
    </div>
    <div class="d-flex flex-column w-50" *ngIf="prospectForm.get('prospectType').value == 4">
      <app-input [form]="prospectForm" controlName="description" label="Ingrese lugar *" type="text"
        placeholder="00000000" buttons="true" class="w-100"></app-input>
    </div>
  </div>
  <div class="file-section" *ngIf="!isPromotionalGuest">
    <div class="file-section-header">
      <label>Adjuntar evidencia para verificar al usuario a registrar:</label>
      <button class="info-icon" (click)="toggleTooltip()">
        <i class="pi pi-info-circle"></i>
      </button>
    </div>
    <div class="custom-tooltip" *ngIf="showTooltip">
      <div class="tooltip-header">
        <span>¿Qué puedo enviar como evidencia?</span>
        <button class="close-button" (click)="closeTooltip()">×</button>
      </div>
      <p style="color: #333333;">
        Puede ser una captura, imagen o screenshot que corrobore al usuario del lugar donde lo conoció.
      </p>
      <div class="tooltip-tail"></div>
    </div>
    <app-file label="" placeholder="JPG, PNG or PDF, file size no more than 10MB" [form]="prospectForm"
      controlName="file" class="w-100" accept=".png, .jpg, .jpeg, .pdf" [maxLength]="10000000"
      [sendAsBase64]="false"></app-file>
  </div>
  <div class="d-flex flex-row justify-content-center gap-4 mt-3" *ngIf="!isPromotionalGuest">
    <button class="btn btn-secondary button-width" type="button" 
    [disabled]="(isLoading || this.prospectForm.invalid || disabledUser)"
      (click)="saveProspect()">
      <span *ngIf="!isLoading"> Guardar </span>
      <div class="d-flex justify-content-center align-items-center" *ngIf="isLoading">
        <p-progressSpinner [style]="{ width: '1.5rem', height: '1rem' }" strokeWidth="8" fill="transparent"
          animationDuration=".5s"></p-progressSpinner>
      </div>
    </button>
  </div>
  <div class="d-flex justify-content-center gap-3 mt-4" *ngIf="isPromotionalGuest">
    <button class="btn btn-outline-secondary" [disabled]="disabledUser" type="button" (click)="onCancel()">Cancelar</button>
    <button class="btn btn-secondary" type="submit" [disabled]="(isRegisteringPromotionalGuest || disabledUser)" (click)="onRegister()">
      <span *ngIf="isRegisteringPromotionalGuest" class="spinner-border spinner-border-sm" role="status"
        aria-hidden="true"></span>
      Registrar
    </button>
  </div>
</form>